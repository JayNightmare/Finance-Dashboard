{% extends "base.html" %} {% block title %}Export Transactions{% endblock %} {%
block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <h1 class="mb-3">Export Transactions</h1>
        <p class="text-muted">
            Filter the transactions you want to export and download them as a
            CSV. We'll include the selected subset only.
        </p>
        <form method="get" class="card card-body mb-4">
            <div class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label">Start</label>
                    {{ form.start }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">End</label>
                    {{ form.end }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">Category</label>
                    {{ form.category }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">Tag</label>
                    {{ form.tag }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">Type</label>
                    {{ form.type }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">Min Amount</label>
                    {{ form.min_amount }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">Max Amount</label>
                    {{ form.max_amount }}
                </div>
                <div class="col-md-3">
                    <label class="form-label">Search</label>
                    {{ form.q }}
                </div>
                <div class="col-md-4 d-flex gap-2">
                    <button
                        type="submit"
                        name="preview"
                        value="1"
                        class="btn btn-outline-secondary"
                    >
                        Preview
                    </button>
                    <button
                        type="submit"
                        name="download"
                        value="1"
                        class="btn btn-primary"
                    >
                        Download CSV
                    </button>
                    <a
                        href="{% url 'core:export' %}"
                        class="btn btn-outline-danger"
                        >Reset</a
                    >
                </div>
            </div>
        </form>

        <div class="card">
            <div class="card-header">
                Preview{% if preview %} (showing up to {{ preview|length }}
                rows){% endif %}
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Currency</th>
                                <th>Category</th>
                                <th>Tags</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if preview %} {% for txn in preview %}
                            <tr>
                                <td>{{ txn.date }}</td>
                                <td>{{ txn.get_type_display }}</td>
                                <td>{{ txn.amount|floatformat:2 }}</td>
                                <td>{{ txn.currency }}</td>
                                <td>{{ txn.category }}</td>
                                <td>
                                    {% for tag in txn.tags.all %}
                                    <span class="badge bg-secondary"
                                        >{{ tag.name }}</span
                                    >
                                    {% empty %}
                                    <span class="text-muted">â€”</span>
                                    {% endfor %}
                                </td>
                                <td>{{ txn.notes|truncatechars:80 }}</td>
                            </tr>
                            {% endfor %} {% else %}
                            <tr>
                                <td
                                    colspan="7"
                                    class="text-center text-muted py-4"
                                >
                                    Use the filters above to preview
                                    transactions before exporting.
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
