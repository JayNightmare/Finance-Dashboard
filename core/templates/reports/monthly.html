{% extends "base.html" %} {% block title %}Monthly Report{% endblock %} {% block
content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <h1 class="mb-3">Monthly Trends</h1>
        <p class="text-muted">
            Income, expenses, and net change over the last 12 months.
        </p>
        <div class="card mb-4">
            <div class="card-body">
                <canvas id="monthlyChart" height="120"></canvas>
            </div>
        </div>
        <div class="card">
            <div class="table-responsive">
                <table class="table table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th class="text-end">Income</th>
                            <th class="text-end">Expense</th>
                            <th class="text-end">Net</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in monthly_rows %}
                        <tr>
                            <td>{{ row.label }}</td>
                            <td class="text-end">
                                {{ row.income|floatformat:2 }}
                            </td>
                            <td class="text-end text-danger">
                                {{ row.expense|floatformat:2 }}
                            </td>
                            <td
                                class="text-end {% if row.net < 0 %}text-danger{% else %}text-success{% endif %}"
                            >
                                {{ row.net|floatformat:2 }}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">
                                No data yet. Add transactions to see the trends.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block extra_js %}
<script>
    (function () {
        const chartElement = document.getElementById("monthlyChart");
        const payload = JSON.parse("{{ chart_data_json|escapejs }}");
        if (!chartElement || !payload.labels.length) {
            return;
        }
        new Chart(chartElement, {
            type: "line",
            data: {
                labels: payload.labels,
                datasets: [
                    {
                        label: "Income",
                        data: payload.income,
                        borderColor: "rgb(25, 135, 84)",
                        backgroundColor: "rgba(25, 135, 84, 0.1)",
                        tension: 0.3,
                        fill: true,
                    },
                    {
                        label: "Expense",
                        data: payload.expense,
                        borderColor: "rgb(220, 53, 69)",
                        backgroundColor: "rgba(220, 53, 69, 0.1)",
                        tension: 0.3,
                        fill: true,
                    },
                    {
                        label: "Net",
                        data: payload.net,
                        borderColor: "rgb(13, 110, 253)",
                        backgroundColor: "rgba(13, 110, 253, 0.1)",
                        tension: 0.3,
                        borderDash: [6, 4],
                        fill: false,
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: "bottom",
                    },
                    tooltip: {
                        mode: "index",
                        intersect: false,
                    },
                },
                interaction: {
                    mode: "nearest",
                    axis: "x",
                    intersect: false,
                },
                scales: {
                    y: {
                        ticks: {
                            callback: (value) =>
                                new Intl.NumberFormat(undefined, {
                                    style: "currency",
                                    currency: "GBP",
                                }).format(value),
                        },
                    },
                },
            },
        });
    })();
</script>
{% endblock %}
